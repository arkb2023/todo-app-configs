# PostgreSQL ConfigMap with Native Init Script
apiVersion: v1
kind: ConfigMap
metadata:
  namespace: exercises
  name: postgres-db-config
  labels:
    app: postgresql-db
data:
  POSTGRES_USER: testdbuser
  POSTGRES_PASSWORD: testdbuserpassword
  POSTGRES_DB: testdb
  DB_HOST: postgresql-db-svc.exercises.svc.cluster.local
  DB_PORT: "5432"
  PGDATA: /data/pgdata
  # # Native Postgres init script (runs automatically on first startup)
  # "init.sql": |
  #   -- Create pingpong_counter table (idempotent)
  #   CREATE TABLE IF NOT EXISTS pingpong_counter (
  #       id SERIAL PRIMARY KEY,
  #       value INTEGER NOT NULL DEFAULT 0
  #   );
    
  #   -- Initialize counter (idempotent)
  #   INSERT INTO pingpong_counter (id, value) 
  #   VALUES (1, 0) 
  #   ON CONFLICT (id) DO NOTHING;
    
  #   -- Verify initialization
  #   SELECT 'Table ready!' as status, 
  #          count(*) as rows, 
  #          max(value) as current_pong 
  #   FROM pingpong_counter;
